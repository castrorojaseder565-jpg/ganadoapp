<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reporte de Estadísticas | BoviControl</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

    <style>
        body { background-color:#F4F7F9; font-family:'Roboto',sans-serif; padding:40px 20px; color:#34495e; }
        h1 { font-family:'Montserrat',sans-serif; font-weight:800; color:#33691E; font-size:2.5rem; margin-bottom:30px; text-align:center; border-bottom:4px solid #00C853; padding-bottom:10px; }
        h2 { font-family:'Montserrat',sans-serif; font-weight:700; color:#33691E; font-size:1.6rem; margin-top:40px; margin-bottom:20px; border-left:5px solid #00C853; padding-left:15px; line-height:1.2; }
        .dashboard-container { max-width:1200px; margin:0 auto; display:flex; flex-wrap:wrap; gap:30px; }

        /* Tarjetas métricas */
        .metrics-grid-summary { flex:1 1 100%; display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
        .metric-card { background-color:white; padding:25px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.08); border-top:5px solid #e0e6ed; transition:border-top-color 0.3s; }
        .metric-card:hover { border-top-color:#00C853; }
        .metric-label { font-size:0.85rem; font-weight:500; color:#7f8c8d; text-transform:uppercase; margin-bottom:5px; }
        .metric-value { font-size:2rem; font-weight:700; font-family:'Montserrat',sans-serif; color:#34495e; line-height:1.2; }
        .metric-card.accent-promedio .metric-value { color:#FF9800; }
        .metric-card.accent-total .metric-value { color:#33691E; }

        /* Sección distribución */
        .stats-section { flex:1 1 100%; display:flex; gap:30px; margin-top:20px; }
        .distribution-table-container { flex:2; background-color:white; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.05); padding:30px; }
        .total-ganado-card { flex:1; background-color:#33691E; color:white; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); padding:30px; text-align:center; }
        .total-ganado-value { font-size:4rem; font-family:'Montserrat',sans-serif; font-weight:800; margin-top:15px; line-height:1; }
        .total-ganado-card p { color:#C0C0C0; margin-top:15px; }

        /* Tablas */
        table { width:100%; border-collapse:collapse; margin-top:15px; }
        th, td { padding:15px 10px; text-align:left; border-bottom:1px solid #f0f4f7; font-size:0.95rem; }
        th { color:#7f8c8d; font-weight:500; text-transform:uppercase; background-color:#fafafa; }
        td:first-child { font-weight:600; color:#34495e; }

        /* Barras progreso */
        .progress-bar-wrap { height:8px; background-color:#e0e6ed; border-radius:4px; overflow:hidden; margin-top:5px; }
        .progress-bar { height:100%; background-color:#00C853; }

        /* Botón volver */
        .btn-volver { display:block; width:fit-content; margin:40px auto 0; background-color:#607D8B; color:white; padding:12px 25px; text-decoration:none; border-radius:8px; font-weight:600; font-size:1rem; transition:background-color 0.3s; }
        .btn-volver:hover { background-color:#455a64; }

        /* Responsividad */
        @media(max-width:900px) { .stats-section { flex-direction:column; } .distribution-table-container,.total-ganado-card { flex:1 1 100%; } }
        @media(max-width:576px) { h1 { font-size:2rem; } .metric-value { font-size:1.6rem; } .total-ganado-value { font-size:3rem; } }
    </style>
</head>
<body>

<div class="dashboard-container">

    <h1>Reporte Ejecutivo de Inventario Ganadero</h1>

    <!-- KPIs -->
    <h2>Indicadores Clave del Hato</h2>
    <div class="metrics-grid-summary">
        <div class="metric-card accent-total">
            <div class="metric-label">Total de Cabezas</div>
            <div class="metric-value" th:text="${totalGanado}">0</div>
        </div>
        <div class="metric-card accent-promedio">
            <div class="metric-label">Peso Promedio (kg)</div>
            <div class="metric-value" th:text="${#numbers.formatDecimal(promedioPeso,1,2)}">0.00</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Machos</div>
            <div class="metric-value" th:text="${machos}">0</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Hembras</div>
            <div class="metric-value" th:text="${hembras}">0</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Saludable (%)</div>
            <th:block th:with="porcentaje=(${saludables}*100.0/(${totalGanado != null && totalGanado != 0 ? totalGanado : 1}))">
                <div class="metric-value" th:text="${#numbers.formatDecimal(porcentaje,1,1)+'%'}">0.0%</div>
            </th:block>
        </div>
    </div>

    <!-- Distribución -->
    <div class="stats-section">
        <div class="distribution-table-container">
            <h2 style="margin-top:0; border:none; border-bottom:2px solid #e0e6ed;">Distribución por Raza</h2>
            <table>
                <thead>
                <tr>
                    <th>Raza</th>
                    <th>Cantidad</th>
                    <th>Proporción (%)</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="entry : ${porRaza}">
                    <td th:text="${entry.key}">Raza</td>
                    <td th:text="${entry.value}">0</td>
                    <td>
                        <th:block th:with="porcentaje=(${entry.value}*100.0/(${totalGanado != null && totalGanado != 0 ? totalGanado : 1}))">
                            <div class="progress-bar-wrap">
                                <div class="progress-bar" th:style="'width:'+${porcentaje}+'%'"></div>
                            </div>
                            <small th:text="${#numbers.formatDecimal(porcentaje,1,1)+'%'}" style="color:#7f8c8d;"></small>
                        </th:block>
                    </td>
                </tr>
                <tr th:if="${porRaza == null or porRaza.isEmpty()}">
                    <td colspan="3" style="text-align:center; color:#7f8c8d; padding:20px;">No hay datos de distribución por raza.</td>
                </tr>
                </tbody>
            </table>

            <h2 style="margin-top:35px; border:none; border-bottom:2px solid #e0e6ed;">Distribución por Estado de Salud</h2>
            <table>
                <thead>
                <tr>
                    <th>Estado</th>
                    <th>Cantidad</th>
                    <th>Proporción (%)</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="entry : ${porEstadoSalud}">
                    <td th:text="${entry.key}">Estado</td>
                    <td th:text="${entry.value}">0</td>
                    <td>
                        <th:block th:with="porcentaje=(${entry.value}*100.0/(${totalGanado != null && totalGanado != 0 ? totalGanado : 1}))">
                            <div class="progress-bar-wrap">
                                <div class="progress-bar"
                                     th:style="'width:'+${porcentaje}+'%'+
                                               (entry.key=='Enfermo'?';background-color:#D32F2F;':
                                               (entry.key=='Saludable'?';background-color:#33691E;':''))">
                                </div>
                            </div>
                            <small th:text="${#numbers.formatDecimal(porcentaje,1,1)+'%'}" style="color:#7f8c8d;"></small>
                        </th:block>
                    </td>
                </tr>
                <tr th:if="${porEstadoSalud == null or porEstadoSalud.isEmpty()}">
                    <td colspan="3" style="text-align:center; color:#7f8c8d; padding:20px;">No hay datos de distribución por estado de salud.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Total General -->
        <div class="total-ganado-card">
            <h2 style="color:white; border:none; padding-left:0; margin-top:0; font-size:1.6rem; margin-bottom:10px;">Total General</h2>
            <p style="color:#C0C0C0;">Inventario Consolidado</p>
            <div class="total-ganado-value" th:text="${totalGanado}">0</div>
            <p style="font-size:1.1rem; border-top:1px solid rgba(255,255,255,0.3); padding-top:15px;">
                <span th:text="${#numbers.formatDecimal(promedioPeso,1,2)}">0.00</span> kg de peso promedio.
            </p>
            <div style="margin-top:30px; text-align:left; font-size:0.9rem;">
                <p style="color:#00C853; font-weight:700;">Alertas de Estado:</p>
                <ul style="list-style:none; padding-left:0; margin-top:5px;">
                    <li th:if="${enfermos>0}" style="color:#FFEB3B;">&#9679; Ganado Enfermo: <span th:text="${enfermos}">0</span></li>
                </ul>
            </div>
        </div>
    </div>

</div>

<a th:href="@{/ganado/lista}" class="btn-volver">Volver al Panel Principal</a>

</body>
</html>

